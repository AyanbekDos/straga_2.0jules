# CCE ‚Äî Content Chunk Enricher

üì¶ ETL-–ø–∞–π–ø–ª–∞–π–Ω, –ø—Ä–µ–≤—Ä–∞—â–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ URL-–æ–≤ –≤ –æ–±–æ–≥–∞—â—ë–Ω–Ω—ã–µ —á–∞–Ω–∫–∏ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è RAG.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- `data/` ‚Äî –≤—Ö–æ–¥–Ω—ã–µ –∏ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã
- `etl/` ‚Äî —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ (extract, clean, chunk, enrich)
- `db/` ‚Äî –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- `scripts/` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–π–ø–ª–∞–π–Ω–æ–º

## –ó–∞–ø—É—Å–∫ –ø–∞–π–ø–ª–∞–π–Ω–∞

```bash
python scripts/update_pipeline.py


# –ü–∞–π–ø–ª–∞–π–Ω –∏–∑–≤–ª–µ—á–µ–Ω–∏—è, –æ—á–∏—Å—Ç–∫–∏ –∏ —Ä–∞–∑–±–∏–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤

–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–±–æ—Ä Python-—Å–∫—Ä–∏–ø—Ç–æ–≤, –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –≤ –ø–æ—ç—Ç–∞–ø–Ω—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä:

1. **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Å—Å—ã–ª–æ–∫** (`dedupe_links.py`)
2. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ ¬´—Å—ã—Ä–æ–µ¬ª HTML** (`extract_meta_with_progress.py`)
3. **–û—á–∏—Å—Ç–∫–∞ HTML ‚Üí —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç** (`clean_text_extractor_with_progress.py`)
4. **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —á–∞–Ω–∫–∏** (`chunker.py`)
5. **(–î–∞–ª—å–Ω–µ–π—à–∏–µ —ç—Ç–∞–ø—ã ‚Äî –æ–±–æ–≥–∞—â–µ–Ω–∏–µ, –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –≤–∞–ª–∏–¥–∞—Ü–∏—è)**

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```
‚îú‚îÄ‚îÄ links.txt                      # –ò—Å—Ö–æ–¥–Ω—ã–π —Å–ø–∏—Å–æ–∫ URL (–æ–¥–Ω–∞ —Å—Å—ã–ª–∫–∞ –≤ —Å—Ç—Ä–æ–∫–µ)
‚îú‚îÄ‚îÄ clean_links.txt                # –ü–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ metadata.jsonl                 # –ü–æ—Å–ª–µ extract_meta_with_progress.py (—Å—ã—Ä–æ–π HTML + –±–∞–∑–æ–≤—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ)
‚îú‚îÄ‚îÄ metadata_with_clean.jsonl      # –ü–æ—Å–ª–µ clean_text_extractor_with_progress.py (–¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ clean_text)
‚îú‚îÄ‚îÄ chunks.jsonl                   # –ü–æ—Å–ª–µ chunker.py (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —á–∞–Ω–∫–∏ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏)
‚îú‚îÄ‚îÄ dedupe_links.py                # –°–∫—Ä–∏–ø—Ç —É–¥–∞–ª–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
‚îú‚îÄ‚îÄ extract_meta_with_progress.py  # –°–∫—Ä–∏–ø—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö + raw_html —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
‚îú‚îÄ‚îÄ clean_text_extractor_with_progress.py  # –°–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏ HTML ‚Üí clean_text —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
‚îú‚îÄ‚îÄ chunker.py                     # –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–±–∏–µ–Ω–∏—è –Ω–∞ —á–∞–Ω–∫–∏
‚îî‚îÄ‚îÄ README.md                      # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## 1. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Å—Å—ã–ª–æ–∫

**–°–∫—Ä–∏–ø—Ç:** `dedupe_links.py`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** —É–±–∏—Ä–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä—ã –∏ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ `links.txt`.
- **–ó–∞–ø—É—Å–∫:**
  ```bash
  pip install argparse
  python dedupe_links.py \
    --input links.txt \
    --output clean_links.txt
  ```
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** —Ñ–∞–π–ª `clean_links.txt` —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ URL.

---

## 2. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ raw HTML

**–°–∫—Ä–∏–ø—Ç:** `extract_meta_with_progress.py`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ø–æ —Å–ø–∏—Å–∫—É `clean_links.txt` —Å–∫–∞—á–∏–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã,
  –ø–∞—Ä—Å–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (url, title, date, author, description, keywords, language)
  –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—ã—Ä–æ–π HTML.
- **–ó–∞–ø—É—Å–∫:**
  ```bash
  pip install aiohttp trafilatura beautifulsoup4 python-dateutil langdetect selenium playwright
  python extract_meta_with_progress.py \
    --input clean_links.txt \
    --output metadata.jsonl
  ```
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** —Ñ–∞–π–ª `metadata.jsonl`, –∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî JSON —Å –ø–æ–ª—è–º–∏:
  ```json
  {
    "url": "...",
    "title": "...",
    "date": "...",
    "author": "...",
    "description": "...",
    "keywords": "...",
    "language": "...",
    "raw_html": "<html>‚Ä¶</html>"
  }
  ```

---

## 3. –û—á–∏—Å—Ç–∫–∞ HTML ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ —á–∏—Å—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞

**–°–∫—Ä–∏–ø—Ç:** `clean_text_extractor_with_progress.py`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** —á–∏—Ç–∞–µ—Ç `metadata.jsonl`, –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏–∑ `raw_html`
  —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç (`clean_text`) —á–µ—Ä–µ–∑ Trafilatura, –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ % –∏ –ª–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏.
- **–ó–∞–ø—É—Å–∫:**
  ```bash
  pip install trafilatura
  python clean_text_extractor_with_progress.py \
    --input metadata.jsonl \
    --output metadata_with_clean.jsonl
  ```
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** —Ñ–∞–π–ª `metadata_with_clean.jsonl`, –∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî JSON:
  ```json
  {
    "url": "...",
    "title": "...",
    "date": "...",
    "author": "...",
    "description": "...",
    "keywords": "...",
    "language": "...",
    "clean_text": "–¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏ –±–µ–∑ HTML",
    "raw_html": "<html>‚Ä¶</html>"
  }
  ```

---

## 4. –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —á–∞–Ω–∫–∏

**–°–∫—Ä–∏–ø—Ç:** `chunker.py`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** —á–∏—Ç–∞–µ—Ç `metadata_with_clean.jsonl`, —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ª–∏—Ç `clean_text`
  –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (NLTK), –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –∏—Ö –≤ —á–∞–Ω–∫–∏ –ø–æ —Ç–æ–∫–µ–Ω–∞–º (tiktoken).
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã CLI:**
  - `--input` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `metadata_with_clean.jsonl`)
  - `--output` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `chunks.jsonl`)
  - `--chunk_size N` (–º–∞–∫—Å–∏–º—É–º N —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ —á–∞–Ω–∫, default=300)
  - `--overlap M` (–ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ M —Ç–æ–∫–µ–Ω–æ–≤ –º–µ–∂–¥—É —Å–æ—Å–µ–¥–Ω–∏–º–∏ —á–∞–Ω–∫–∞–º–∏, default=0)
  - `--model` (–º–æ–¥–µ–ª—å –¥–ª—è tiktoken, default=`gpt-3.5-turbo`)
  - `--verbose` (–ø–æ–¥—Ä–æ–±–Ω—ã–π –ª–æ–≥)
- **–ó–∞–ø—É—Å–∫ –ø—Ä–∏–º–µ—Ä:**
  ```bash
  pip install nltk tiktoken tqdm
  python chunker.py \
    --input metadata_with_clean.jsonl \
    --output chunks.jsonl \
    --chunk_size 500 \
    --overlap 30 \
    --verbose
  ```
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** —Ñ–∞–π–ª `chunks.jsonl`, –≥–¥–µ –∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî JSON —Å –ø–æ–ª—è–º–∏:
  ```json
  {
    "url": "‚Ä¶",
    "title": "‚Ä¶",
    "date": "‚Ä¶",
    "author": "‚Ä¶",
    "description": "‚Ä¶",
    "keywords": "‚Ä¶",
    "language": "‚Ä¶",
    "chunk_id": 0,
    "chunk_text": "–¢–µ–∫—Å—Ç —á–∞–Ω–∫–∞ (–¥–æ 500 —Ç–æ–∫–µ–Ω–æ–≤, —Å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ–º)"
  }
  ```

---

## 5. –î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏

- **–û–±–æ–≥–∞—â–µ–Ω–∏–µ —á–∞–Ω–∫–æ–≤** —á–µ—Ä–µ–∑ GPT (RAG-–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, summary, entities –∏ —Ç.–¥.)
- **–í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (Pinecone, Supabase)
- **–í–∞–ª–∏–¥–∞—Ü–∏—è** –∏ –æ—Ç—á—ë—Ç—ã –æ–± –æ—à–∏–±–∫–∞—Ö
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** –≤ n8n, Telegram-–±–æ—Ç –∏–ª–∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

---

> **–°–æ–≤–µ—Ç:** —Ö—Ä–∞–Ω–∏—Ç–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫ (`errors.log`), —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —ç—Ç–∞–ø—ã, –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—è –∑–∞–Ω–æ–≤–æ –≤–µ—Å—å –ø–∞–π–ø–ª–∞–π–Ω.

---

**–£–¥–∞—á–∏ –≤ —Ä–∞–±–æ—Ç–µ!**
